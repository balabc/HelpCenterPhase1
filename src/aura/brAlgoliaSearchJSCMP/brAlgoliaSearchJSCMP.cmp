<aura:component implements="forceCommunity:availableForAllPageTypes" access="global">
    <aura:attribute name="brFilter" type="Map" />
    <aura:attribute name="categories" type="Map"/>
    <aura:attribute name="hasData" type="String" default="off"/>
    <aura:attribute name="searchText" type="String"/> 
    
    <aura:handler name="eventFromBrAlgoliaFilter" event="c:brAlgoliaFilterEvent" action="{!c.onChangeFilter}"/>
    
    <ltng:require scripts='/resource/instantsearch/algoliasearch.min.js' afterScriptsLoaded="{!c.jsLoaded}" />
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="change" value="{!v.brFilter}" action="{!c.searchChange}"/>
    
    
    <div class="modal-overlay"></div>
    <div class="wrap-modal search-modal-wrapper">
        <div class="modal">
            <div class="modal__close-button icon-svg-close-lg-grey"></div>
            <div class="modal__inner">
                <div class="container relative">
                    <div class="serp-header">
                        <div class="serp__filter-trigger-icon"></div>
                        <div class="wrap-searchbox">
                            <div class="searchbox">
                                <input type="text" class="searchbox__input-text" placeholder="Search" value="{!v.searchText}" keyup="{!c.searchKeyUp}" change="{!c.searchChange}" />
                                <input type="reset" class="searchbox__input-reset" value="Clear" />
                            </div>
                        </div>
                    </div>
                    
                    <div class="serp clr">
                        <div class="serp__filter-section" data-active="{!v.hasData != 'off'}">
                            <div class="serp__panel">
                                <div class="serp__filter-section-panel-inner">
                                    <h3 class="h3 serp__title">Refine</h3>
                            		<c:brAlgoliaFilterJSCMP />
                                </div>    
                            </div>    
                        </div>    
                        <aura:if isTrue="{!v.hasData}">
                            <div class="serp__results-section">
                                <div class="serp__panel">
                                    <aura:iteration items="{!v.categories}" var="category">
                                        <div class="search_category">
                                            <div class="serp__section">
                                                <h3 class="h3 serp__title"><aura:unescapedHtml value="{!category.name}"/></h3>
                                            </div>
                                            <aura:iteration items="{!category.items}" var="item">
                                                <div class="serp__item">
                                                    <div class="serp__item-left">
                                                        <div class="serp__item-left-inner">
                                                            <aura:unescapedHtml value="{!item.left}"/>
                                                        </div>
                                                    </div>
                                                    <div class="serp__item-right">
                                                        <div class="serp__item-right-inner">
                                                            <aura:iteration items="{!item.right}" var="line">
                                                                <aura:unescapedHtml value="{!line}"/>
                                                            </aura:iteration>
                                                        </div>
                                                    </div>
                                                </div>
                                            </aura:iteration>
                                            <a href="javascript:void(0);" class="serp__section-link">View more results for <aura:unescapedHtml value="{!category.name}"/></a>
                                        </div>
                                    </aura:iteration>
                                </div><!-- / end of .serp__panel -->
                            </div><!-- / end of .serp__results-section -->
                            <aura:set attribute="else">
                                <p class="serp__text-no-result">No results yet. Please begin typing to search the BigCommerce Help Centerâ€¦</p>
                            </aura:set>
                        </aura:if>  
                    </div>
                </div>
            </div>
        </div>
    </div><!-- / end of .wrap-modal -->
</aura:component>